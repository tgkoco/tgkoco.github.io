<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  
  
  
  
  
  <link rel="prev" href="https://tgkoco.github.io/2019/1.unknwon%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" />
  <link rel="next" href="https://tgkoco.github.io/2019/golanglog/" />
  <link rel="canonical" href="https://tgkoco.github.io/2019/jwtjson-web-token%E7%9A%84%E5%8E%9F%E7%90%86/" />
  <link rel='shortcut icon' type='image/x-icon' href='//tgkoco.github.io/favicon.ico' />
  <link rel="apple-touch-icon" sizes="180x180" href="//tgkoco.github.io/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="//tgkoco.github.io/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="//tgkoco.github.io/favicon.ico">
  <link rel="manifest" href="https://tgkoco.github.io/site.webmanifest">
  <link rel="mask-icon" href="https://tgkoco.github.io/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           JSON Web Tokençš„ä½œç”¨å’Œè§£é‡Š | TG koco
       
  </title>
  <meta name="title" content="JSON Web Tokençš„ä½œç”¨å’Œè§£é‡Š | TG koco">
    
  
  <link rel="stylesheet" href="https://tgkoco.github.io/font/iconfont.css">
  <link rel="stylesheet" href="https://tgkoco.github.io/css/main.min.css">


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JSON Web Tokençš„ä½œç”¨å’Œè§£é‡Š"/>
<meta name="twitter:description" content="JSON Web Tokenï¼ˆç¼©å†™ JWTï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæœ¬æ–‡ä»‹ç»å®ƒçš„åŸç†å’Œç”¨æ³•ã€‚ ä¸€ã€è·¨åŸŸè®¤è¯çš„é—®é¢˜ äº’è”ç½‘æœåŠ¡ç¦»ä¸å¼€ç”¨æˆ·è®¤è¯ã€‚ä¸€èˆ¬æµç¨‹æ˜¯ä¸‹é¢è¿™æ ·ã€‚
1ã€ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚ 2ã€æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œåœ¨å½“å‰å¯¹è¯ï¼ˆsessionï¼‰é‡Œé¢ä¿å­˜ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€ç™»å½•æ—¶é—´ç­‰ç­‰ã€‚ 3ã€æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª session_idï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚ 4ã€ç”¨æˆ·éšåçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ Cookieï¼Œå°† session_id ä¼ å›æœåŠ¡å™¨ã€‚ 5ã€æœåŠ¡å™¨æ”¶åˆ° session_idï¼Œæ‰¾åˆ°å‰æœŸä¿å­˜çš„æ•°æ®ï¼Œç”±æ­¤å¾—çŸ¥ç”¨æˆ·çš„èº«ä»½ã€‚ è¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºï¼Œæ‰©å±•æ€§ï¼ˆscalingï¼‰ä¸å¥½ã€‚å•æœºå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼Œæˆ–è€…æ˜¯è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚
ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å’Œ B ç½‘ç«™æ˜¯åŒä¸€å®¶å…¬å¸çš„å…³è”æœåŠ¡ã€‚ç°åœ¨è¦æ±‚ï¼Œç”¨æˆ·åªè¦åœ¨å…¶ä¸­ä¸€ä¸ªç½‘ç«™ç™»å½•ï¼Œå†è®¿é—®å¦ä¸€ä¸ªç½‘ç«™å°±ä¼šè‡ªåŠ¨ç™»å½•ï¼Œè¯·é—®æ€ä¹ˆå®ç°ï¼Ÿ
ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ session æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥æ•°æ®åº“æˆ–åˆ«çš„æŒä¹…å±‚ã€‚å„ç§æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å‘æŒä¹…å±‚è¯·æ±‚æ•°æ®ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¶æ„æ¸…æ™°ï¼Œç¼ºç‚¹æ˜¯å·¥ç¨‹é‡æ¯”è¾ƒå¤§ã€‚å¦å¤–ï¼ŒæŒä¹…å±‚ä¸‡ä¸€æŒ‚äº†ï¼Œå°±ä¼šå•ç‚¹å¤±è´¥ã€‚
å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æœåŠ¡å™¨ç´¢æ€§ä¸ä¿å­˜ session æ•°æ®äº†ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›æœåŠ¡å™¨ã€‚JWT å°±æ˜¯è¿™ç§æ–¹æ¡ˆçš„ä¸€ä¸ªä»£è¡¨ã€‚
äºŒã€JWT çš„åŸç† JWT çš„åŸç†æ˜¯ï¼ŒæœåŠ¡å™¨è®¤è¯ä»¥åï¼Œç”Ÿæˆä¸€ä¸ª JSON å¯¹è±¡ï¼Œå‘å›ç»™ç”¨æˆ·ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚
{ &#34;å§“å&#34;: &#34;å¼ ä¸‰&#34;, &#34;è§’è‰²&#34;: &#34;ç®¡ç†å‘˜&#34;, &#34;åˆ°æœŸæ—¶é—´&#34;: &#34;2018å¹´7æœˆ1æ—¥0ç‚¹0åˆ†&#34; } ä»¥åï¼Œç”¨æˆ·ä¸æœåŠ¡ç«¯é€šä¿¡çš„æ—¶å€™ï¼Œéƒ½è¦å‘å›è¿™ä¸ª JSON å¯¹è±¡ã€‚æœåŠ¡å™¨å®Œå…¨åªé è¿™ä¸ªå¯¹è±¡è®¤å®šç”¨æˆ·èº«ä»½ã€‚ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç¯¡æ”¹æ•°æ®ï¼ŒæœåŠ¡å™¨åœ¨ç”Ÿæˆè¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šåŠ ä¸Šç­¾åï¼ˆè¯¦è§åæ–‡ï¼‰ã€‚
æœåŠ¡å™¨å°±ä¸ä¿å­˜ä»»ä½• session æ•°æ®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å˜æˆæ— çŠ¶æ€äº†ï¼Œä»è€Œæ¯”è¾ƒå®¹æ˜“å®ç°æ‰©å±•ã€‚
ä¸‰ã€JWT çš„æ•°æ®ç»“æ„ å®é™…çš„ JWT å¤§æ¦‚å°±åƒä¸‹é¢è¿™æ ·ã€‚
å®ƒæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚æ³¨æ„ï¼ŒJWT å†…éƒ¨æ˜¯æ²¡æœ‰æ¢è¡Œçš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä¾¿äºå±•ç¤ºï¼Œå°†å®ƒå†™æˆäº†å‡ è¡Œã€‚
ä¸€ä¸ªJWTå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¤´éƒ¨ã€è½½è·ä¸ç­¾åã€‚
JWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚
Headerï¼ˆå¤´éƒ¨ï¼‰ Payloadï¼ˆè´Ÿè½½ï¼‰ Signatureï¼ˆç­¾åï¼‰ å†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚
Header.Payload.Signature ä¸‹é¢ä¾æ¬¡ä»‹ç»è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚
3.1 Header Header éƒ¨åˆ†æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œæè¿° JWT çš„å…ƒæ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸‹é¢çš„æ ·å­ã€‚"/>

  <script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "JSON Web Tokençš„ä½œç”¨å’Œè§£é‡Š",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/tgkoco.github.io\/2019\/jwtjson-web-token%E7%9A%84%E5%8E%9F%E7%90%86\/"
  },
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/tgkoco.github.io\/cover.png",
    "width":  800 ,
    "height":  600 
  },
  "genre": "posts",
  "keywords": "å­¦ä¹ , ç–‘æƒ‘",
  "wordcount":  520 ,
  "url": "https:\/\/tgkoco.github.io\/2019\/jwtjson-web-token%E7%9A%84%E5%8E%9F%E7%90%86\/",
  "datePublished": "2019-09-07T01:55:38\x2b08:00",
  "dateModified": "2019-09-07T01:55:38\x2b08:00",
  
  "publisher": {
    "@type": "Organization",
    "name": "ç³–æœğŸ¬",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/tgkoco.github.io\/logo.png",
      "width":  127 ,
      "height":  40 
    }
  },
  "author": {
    "@type": "Person",
    "name": "TGğŸ¬KOCO"
  },
  "description": ""
}
</script>
</head>

  



  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="https://tgkoco.github.io/">TG koco</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="https://tgkoco.github.io/posts/" title="">Blog</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/categories/" title="">categories</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/tags/" title="">tags</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/poetry-and-distance/" title="Poetry and Distance">Poetry and Distance</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/about/" title="About">About</a>
                
                <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-sun"></i></a>&nbsp;<a href="https://tgkoco.github.io/">TG koco</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="https://tgkoco.github.io/posts/" title="">Blog</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/categories/" title="">categories</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/tags/" title="">tags</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/poetry-and-distance/" title="Poetry and Distance">Poetry and Distance</a>
                
                <a class="menu-item" href="https://tgkoco.github.io/about/" title="About">About</a>
                
        </div>
    </div>
</nav>

    	 <main class="main">
          <div class="container">
      		
<article class="post-warp">
    <header class="post-header">
        <h1 class="post-title">JSON Web Tokençš„ä½œç”¨å’Œè§£é‡Š</h1>
        <div class="post-meta">
            Written by <a href="https://tgkoco.github.io/" rel="author">TGğŸ¬KOCO</a> with â™¥ 
                <span class="post-time">
                    on <time datetime=2019-09-07 >7 September 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://tgkoco.github.io/categories/%E7%88%B1%E7%94%9F%E6%B4%BB/"> çˆ±ç”Ÿæ´» </a>
                        
                </span>
                <i class="iconfont icon-timer"></i>
                3 min
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          

<h2 id="json-web-token-ç¼©å†™-jwt-æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆ-æœ¬æ–‡ä»‹ç»å®ƒçš„åŸç†å’Œç”¨æ³•">JSON Web Tokenï¼ˆç¼©å†™ JWTï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæœ¬æ–‡ä»‹ç»å®ƒçš„åŸç†å’Œç”¨æ³•ã€‚</h2>

<h3 id="ä¸€-è·¨åŸŸè®¤è¯çš„é—®é¢˜">ä¸€ã€è·¨åŸŸè®¤è¯çš„é—®é¢˜</h3>

<p>äº’è”ç½‘æœåŠ¡ç¦»ä¸å¼€ç”¨æˆ·è®¤è¯ã€‚ä¸€èˆ¬æµç¨‹æ˜¯ä¸‹é¢è¿™æ ·ã€‚</p>
<div class="highlight"><pre class="chroma">1ã€ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚
2ã€æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œåœ¨å½“å‰å¯¹è¯ï¼ˆsessionï¼‰é‡Œé¢ä¿å­˜ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€ç™»å½•æ—¶é—´ç­‰ç­‰ã€‚
3ã€æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª session_idï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚
4ã€ç”¨æˆ·éšåçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ Cookieï¼Œå°† session_id ä¼ å›æœåŠ¡å™¨ã€‚
5ã€æœåŠ¡å™¨æ”¶åˆ° session_idï¼Œæ‰¾åˆ°å‰æœŸä¿å­˜çš„æ•°æ®ï¼Œç”±æ­¤å¾—çŸ¥ç”¨æˆ·çš„èº«ä»½ã€‚</pre></div>
<p>è¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºï¼Œæ‰©å±•æ€§ï¼ˆscalingï¼‰ä¸å¥½ã€‚å•æœºå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼Œæˆ–è€…æ˜¯è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚</p>

<p>ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å’Œ B ç½‘ç«™æ˜¯åŒä¸€å®¶å…¬å¸çš„å…³è”æœåŠ¡ã€‚ç°åœ¨è¦æ±‚ï¼Œç”¨æˆ·åªè¦åœ¨å…¶ä¸­ä¸€ä¸ªç½‘ç«™ç™»å½•ï¼Œå†è®¿é—®å¦ä¸€ä¸ªç½‘ç«™å°±ä¼šè‡ªåŠ¨ç™»å½•ï¼Œè¯·é—®æ€ä¹ˆå®ç°ï¼Ÿ</p>

<p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ session æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥æ•°æ®åº“æˆ–åˆ«çš„æŒä¹…å±‚ã€‚å„ç§æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å‘æŒä¹…å±‚è¯·æ±‚æ•°æ®ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¶æ„æ¸…æ™°ï¼Œç¼ºç‚¹æ˜¯å·¥ç¨‹é‡æ¯”è¾ƒå¤§ã€‚å¦å¤–ï¼ŒæŒä¹…å±‚ä¸‡ä¸€æŒ‚äº†ï¼Œå°±ä¼šå•ç‚¹å¤±è´¥ã€‚</p>

<p>å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æœåŠ¡å™¨ç´¢æ€§ä¸ä¿å­˜ session æ•°æ®äº†ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›æœåŠ¡å™¨ã€‚JWT å°±æ˜¯è¿™ç§æ–¹æ¡ˆçš„ä¸€ä¸ªä»£è¡¨ã€‚</p>

<h3 id="äºŒ-jwt-çš„åŸç†">äºŒã€JWT çš„åŸç†</h3>

<p>JWT çš„åŸç†æ˜¯ï¼ŒæœåŠ¡å™¨è®¤è¯ä»¥åï¼Œç”Ÿæˆä¸€ä¸ª JSON å¯¹è±¡ï¼Œå‘å›ç»™ç”¨æˆ·ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚</p>
<div class="highlight"><pre class="chroma">{
  &#34;å§“å&#34;: &#34;å¼ ä¸‰&#34;,
  &#34;è§’è‰²&#34;: &#34;ç®¡ç†å‘˜&#34;,
  &#34;åˆ°æœŸæ—¶é—´&#34;: &#34;2018å¹´7æœˆ1æ—¥0ç‚¹0åˆ†&#34;
}</pre></div>
<p>ä»¥åï¼Œç”¨æˆ·ä¸æœåŠ¡ç«¯é€šä¿¡çš„æ—¶å€™ï¼Œéƒ½è¦å‘å›è¿™ä¸ª JSON å¯¹è±¡ã€‚æœåŠ¡å™¨å®Œå…¨åªé è¿™ä¸ªå¯¹è±¡è®¤å®šç”¨æˆ·èº«ä»½ã€‚ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç¯¡æ”¹æ•°æ®ï¼ŒæœåŠ¡å™¨åœ¨ç”Ÿæˆè¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šåŠ ä¸Šç­¾åï¼ˆè¯¦è§åæ–‡ï¼‰ã€‚</p>

<p>æœåŠ¡å™¨å°±ä¸ä¿å­˜ä»»ä½• session æ•°æ®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å˜æˆæ— çŠ¶æ€äº†ï¼Œä»è€Œæ¯”è¾ƒå®¹æ˜“å®ç°æ‰©å±•ã€‚</p>

<h3 id="ä¸‰-jwt-çš„æ•°æ®ç»“æ„">ä¸‰ã€JWT çš„æ•°æ®ç»“æ„</h3>

<p>å®é™…çš„ JWT å¤§æ¦‚å°±åƒä¸‹é¢è¿™æ ·ã€‚</p>

<p>å®ƒæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚æ³¨æ„ï¼ŒJWT å†…éƒ¨æ˜¯æ²¡æœ‰æ¢è¡Œçš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä¾¿äºå±•ç¤ºï¼Œå°†å®ƒå†™æˆäº†å‡ è¡Œã€‚</p>

<p>ä¸€ä¸ªJWTå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå¤´éƒ¨ã€è½½è·ä¸ç­¾åã€‚</p>

<p>JWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚</p>
<div class="highlight"><pre class="chroma">    Headerï¼ˆå¤´éƒ¨ï¼‰
    Payloadï¼ˆè´Ÿè½½ï¼‰
    Signatureï¼ˆç­¾åï¼‰</pre></div>
<p>å†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>
<div class="highlight"><pre class="chroma">Header.Payload.Signature</pre></div>
<p>ä¸‹é¢ä¾æ¬¡ä»‹ç»è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p>

<h4 id="3-1-header">3.1 Header</h4>

<p>Header éƒ¨åˆ†æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œæè¿° JWT çš„å…ƒæ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>
<div class="highlight"><pre class="chroma">{
  &#34;alg&#34;: &#34;HS256&#34;,
  &#34;typ&#34;: &#34;JWT&#34;
}</pre></div>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œalgå±æ€§è¡¨ç¤ºç­¾åçš„ç®—æ³•ï¼ˆalgorithmï¼‰ï¼Œé»˜è®¤æ˜¯ HMAC SHA256ï¼ˆå†™æˆ HS256ï¼‰ï¼›typå±æ€§è¡¨ç¤ºè¿™ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰çš„ç±»å‹ï¼ˆtypeï¼‰ï¼ŒJWT ä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚</p>

<p>æœ€åï¼Œå°†ä¸Šé¢çš„ JSON å¯¹è±¡ä½¿ç”¨ Base64URL ç®—æ³•ï¼ˆè¯¦è§åæ–‡ï¼‰è½¬æˆå­—ç¬¦ä¸²ã€‚</p>

<h4 id="3-2-payload">3.2 Payload</h4>

<p>Payload éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚JWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œä¾›é€‰ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma">    iss (issuer)ï¼šç­¾å‘äºº
    exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´
    sub (subject)ï¼šä¸»é¢˜
    aud (audience)ï¼šå—ä¼—
    nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´
    iat (Issued At)ï¼šç­¾å‘æ—¶é—´
    jti (JWT ID)ï¼šç¼–å·</pre></div>
<p>é™¤äº†å®˜æ–¹å­—æ®µï¼Œä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†å®šä¹‰ç§æœ‰å­—æ®µï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma">{
  &#34;sub&#34;: &#34;1234567890&#34;,
  &#34;name&#34;: &#34;John Doe&#34;,
  &#34;admin&#34;: true
}</pre></div>
<p>æ³¨æ„ï¼ŒJWT é»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¯»åˆ°ï¼Œæ‰€ä»¥ä¸è¦æŠŠç§˜å¯†ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªéƒ¨åˆ†ã€‚</p>

<p>è¿™ä¸ª JSON å¯¹è±¡ä¹Ÿè¦ä½¿ç”¨ Base64URL ç®—æ³•è½¬æˆå­—ç¬¦ä¸²ã€‚</p>

<h4 id="3-3-signature">3.3 Signature</h4>

<p>Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚</p>

<p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢çš„å…¬å¼äº§ç”Ÿç­¾åã€‚</p>
<div class="highlight"><pre class="chroma">HMACSHA256(
  base64UrlEncode(header) + &#34;.&#34; +
  base64UrlEncode(payload),
  secret)</pre></div>
<p>ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨&rdquo;ç‚¹&rdquo;ï¼ˆ.ï¼‰åˆ†éš”ï¼Œå°±å¯ä»¥è¿”å›ç»™ç”¨æˆ·ã€‚</p>

<h4 id="3-4-base64url">3.4 Base64URL</h4>

<p>å‰é¢æåˆ°ï¼ŒHeader å’Œ Payload ä¸²å‹åŒ–çš„ç®—æ³•æ˜¯ Base64URLã€‚è¿™ä¸ªç®—æ³•è·Ÿ Base64 ç®—æ³•åŸºæœ¬ç±»ä¼¼ï¼Œä½†æœ‰ä¸€äº›å°çš„ä¸åŒã€‚</p>

<p>JWT ä½œä¸ºä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œæœ‰äº›åœºåˆå¯èƒ½ä¼šæ”¾åˆ° URLï¼ˆæ¯”å¦‚ api.example.com/?token=xxxï¼‰ã€‚Base64 æœ‰ä¸‰ä¸ªå­—ç¬¦+ã€/å’Œ=ï¼Œåœ¨ URL é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥è¦è¢«æ›¿æ¢æ‰ï¼š=è¢«çœç•¥ã€+æ›¿æ¢æˆ-ï¼Œ/æ›¿æ¢æˆ_ ã€‚è¿™å°±æ˜¯ Base64URL ç®—æ³•ã€‚</p>

<h3 id="å››-jwt-çš„ä½¿ç”¨æ–¹å¼">å››ã€JWT çš„ä½¿ç”¨æ–¹å¼</h3>

<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JWTï¼Œå¯ä»¥å‚¨å­˜åœ¨ Cookie é‡Œé¢ï¼Œä¹Ÿå¯ä»¥å‚¨å­˜åœ¨ localStorageã€‚</p>

<p>æ­¤åï¼Œå®¢æˆ·ç«¯æ¯æ¬¡ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œéƒ½è¦å¸¦ä¸Šè¿™ä¸ª JWTã€‚ä½ å¯ä»¥æŠŠå®ƒæ”¾åœ¨ Cookie é‡Œé¢è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯è¿™æ ·ä¸èƒ½è·¨åŸŸï¼Œæ‰€ä»¥æ›´å¥½çš„åšæ³•æ˜¯æ”¾åœ¨ HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯Authorizationå­—æ®µé‡Œé¢ã€‚</p>
<div class="highlight"><pre class="chroma">Authorization: Bearer &lt;token&gt;</pre></div>
<p>å¦ä¸€ç§åšæ³•æ˜¯ï¼Œè·¨åŸŸçš„æ—¶å€™ï¼ŒJWT å°±æ”¾åœ¨ POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œé¢ã€‚</p>

<h3 id="äº”-jwt-çš„å‡ ä¸ªç‰¹ç‚¹">äº”ã€JWT çš„å‡ ä¸ªç‰¹ç‚¹</h3>

<p>ï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</p>

<p>ï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</p>

<p>ï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p>

<p>ï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</p>

<p>ï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</p>

<p>ï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</p>

<h2 id="jwtç­¾åç®—æ³•ä¸­hs256å’Œrs256æœ‰ä»€ä¹ˆåŒºåˆ«">JWTç­¾åç®—æ³•ä¸­HS256å’ŒRS256æœ‰ä»€ä¹ˆåŒºåˆ«</h2>

<ul>
<li><p>JWTç­¾åç®—æ³•ä¸­ï¼Œä¸€èˆ¬æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼Œä¸€ä¸ªé‡‡ç”¨HS256,å¦å¤–ä¸€ä¸ªå°±æ˜¯é‡‡ç”¨RS256ã€‚</p></li>

<li><p>ç­¾åå®é™…ä¸Šæ˜¯ä¸€ä¸ªåŠ å¯†çš„è¿‡ç¨‹ï¼Œç”Ÿæˆä¸€æ®µæ ‡è¯†ï¼ˆä¹Ÿæ˜¯JWTçš„ä¸€éƒ¨åˆ†ï¼‰ä½œä¸ºæ¥æ”¶æ–¹éªŒè¯ä¿¡æ¯æ˜¯å¦è¢«ç¯¡æ”¹çš„ä¾æ®ã€‚</p></li>

<li><p>RS256 (é‡‡ç”¨SHA-256 çš„ RSA ç­¾å) æ˜¯ä¸€ç§éå¯¹ç§°ç®—æ³•, å®ƒä½¿ç”¨å…¬å…±/ç§é’¥å¯¹: æ ‡è¯†æä¾›æ–¹é‡‡ç”¨ç§é’¥ç”Ÿæˆç­¾å, JWT çš„ä½¿ç”¨æ–¹è·å–å…¬é’¥ä»¥éªŒè¯ç­¾åã€‚ç”±äºå…¬é’¥ (ä¸ç§é’¥ç›¸æ¯”) ä¸éœ€è¦ä¿æŠ¤, å› æ­¤å¤§å¤šæ•°æ ‡è¯†æä¾›æ–¹ä½¿å…¶æ˜“äºä½¿ç”¨æ–¹è·å–å’Œä½¿ç”¨ (é€šå¸¸é€šè¿‡ä¸€ä¸ªå…ƒæ•°æ®URL).(å…¬é’¥ç­¾åç§é’¥è§£,ç§é’¥ç­¾å,å…¬é’¥è§£)</p></li>

<li><p>HS256 (å¸¦æœ‰ SHA-256 çš„ HMAC æ˜¯ä¸€ç§å¯¹ç§°ç®—æ³•, åŒæ–¹ä¹‹é—´ä»…å…±äº«ä¸€ä¸ª å¯†é’¥ã€‚ç”±äºä½¿ç”¨ç›¸åŒçš„å¯†é’¥ç”Ÿæˆç­¾åå’ŒéªŒè¯ç­¾å, å› æ­¤å¿…é¡»æ³¨æ„ç¡®ä¿å¯†é’¥ä¸è¢«æ³„å¯†ã€‚</p></li>

<li><p>åœ¨å¼€å‘åº”ç”¨(éç½‘ç«™)çš„æ—¶å€™å¯ç”¨JWTï¼Œä½¿ç”¨RS256æ›´åŠ å®‰å…¨ï¼Œä½ å¯ä»¥æ§åˆ¶è°èƒ½ä½¿ç”¨ä»€ä¹ˆç±»å‹çš„å¯†é’¥ã€‚å¦å¤–ï¼Œå¦‚æœä½ æ— æ³•æ§åˆ¶å®¢æˆ·ç«¯ï¼Œæ— æ³•åšåˆ°å¯†é’¥çš„å®Œå…¨ä¿å¯†ï¼ŒRS256ä¼šæ˜¯ä¸ªæ›´ä½³çš„é€‰æ‹©ï¼ŒJWTçš„ä½¿ç”¨æ–¹åªéœ€è¦çŸ¥é“å…¬é’¥ã€‚</p></li>

<li><p>ç”±äºå…¬é’¥é€šå¸¸å¯ä»¥ä»å…ƒæ•°æ®URLèŠ‚ç‚¹è·å¾—ï¼Œå› æ­¤å¯ä»¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œè¿›è¡Œç¼–ç¨‹ä»¥è‡ªåŠ¨æ£€ç´¢å…¬é’¥ã€‚å¦‚æœé‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œä»æœåŠ¡å™¨ä¸Šç›´æ¥ä¸‹è½½å…¬é’¥ä¿¡æ¯ï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘é…ç½®ä¿¡æ¯ã€‚</p></li>

<li><p>å¦‚æœåªæ˜¯é›†ä¸­ç­¾åï¼Œé›†ä¸­éªŒè¯ç­¾åé‚£æ²¡å•¥åŒºåˆ«ã€‚é‡‡ç”¨éå¯¹ç§°ç®—æ³•ç­¾åï¼Œåªè¦æœ‰å…¬é’¥å°±å¯ä»¥éªŒè¯ç­¾åï¼Œå¯ä»¥é¢å‘ç»™å…¶ä»–åº”ç”¨  .</p></li>
</ul>

<h4 id="javaä¸­çš„å®é™…ä½¿ç”¨">javaä¸­çš„å®é™…ä½¿ç”¨</h4>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">class</span> <span class="n">JwtUtils</span> <span class="p">{</span>
    <span class="cm">/**
</span><span class="cm">     * ç­¾å‘JWT
</span><span class="cm">     * @param id
</span><span class="cm">     * @param subject å¯ä»¥æ˜¯JSONæ•°æ® å°½å¯èƒ½å°‘
</span><span class="cm">     * @param ttlMillis
</span><span class="cm">     * @return  String
</span><span class="cm">     *
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">static</span> <span class="n">String</span> <span class="nf">createJWT</span><span class="p">(</span><span class="n">String</span> <span class="nf">id</span><span class="p">,</span> <span class="n">String</span> <span class="nf">subject</span><span class="p">,</span> <span class="kt">long</span> <span class="nf">ttlMillis</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SignatureAlgorithm</span> <span class="nf">signatureAlgorithm</span> <span class="o">=</span> <span class="n">SignatureAlgorithm</span><span class="p">.</span><span class="na">HS256</span><span class="p">;</span>
        <span class="kt">long</span> <span class="nf">nowMillis</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
        <span class="n">Date</span> <span class="nf">now</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">(</span><span class="n">nowMillis</span><span class="p">);</span>
        <span class="n">SecretKey</span> <span class="nf">secretKey</span> <span class="o">=</span> <span class="n">generalKey</span><span class="p">();</span>
        <span class="n">JwtBuilder</span> <span class="nf">builder</span> <span class="o">=</span> <span class="n">Jwts</span><span class="p">.</span><span class="na">builder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">setId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
                <span class="p">.</span><span class="na">setSubject</span><span class="p">(</span><span class="n">subject</span><span class="p">)</span>   <span class="c1">// ä¸»é¢˜
</span><span class="c1"></span>                <span class="p">.</span><span class="na">setIssuer</span><span class="p">(</span><span class="s">&#34;user&#34;</span><span class="p">)</span>     <span class="c1">// ç­¾å‘è€…
</span><span class="c1"></span>                <span class="p">.</span><span class="na">setIssuedAt</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>      <span class="c1">// ç­¾å‘æ—¶é—´
</span><span class="c1"></span>                <span class="p">.</span><span class="na">signWith</span><span class="p">(</span><span class="n">signatureAlgorithm</span><span class="p">,</span> <span class="n">secretKey</span><span class="p">);</span> <span class="c1">// ç­¾åç®—æ³•ä»¥åŠå¯†åŒ™
</span><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="n">ttlMillis</span> <span class="o">&gt;=</span> <span class="n">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">long</span> <span class="nf">expMillis</span> <span class="o">=</span> <span class="n">nowMillis</span> <span class="o">+</span> <span class="n">ttlMillis</span><span class="p">;</span>
            <span class="n">Date</span> <span class="nf">expDate</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="p">(</span><span class="n">expMillis</span><span class="p">);</span>
            <span class="n">builder</span><span class="p">.</span><span class="na">setExpiration</span><span class="p">(</span><span class="n">expDate</span><span class="p">);</span> <span class="c1">// è¿‡æœŸæ—¶é—´
</span><span class="c1"></span>        <span class="p">}</span>
        <span class="k">return</span> <span class="n">builder</span><span class="p">.</span><span class="na">compact</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="cm">/**
</span><span class="cm">     * éªŒè¯JWT
</span><span class="cm">     * @param jwtStr
</span><span class="cm">     * @return
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">static</span> <span class="n">CheckResult</span> <span class="nf">validateJWT</span><span class="p">(</span><span class="n">String</span> <span class="nf">jwtStr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">CheckResult</span> <span class="nf">checkResult</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CheckResult</span><span class="p">();</span>
        <span class="n">Claims</span> <span class="nf">claims</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">claims</span> <span class="o">=</span> <span class="n">parseJWT</span><span class="p">(</span><span class="n">jwtStr</span><span class="p">);</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setSuccess</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setClaims</span><span class="p">(</span><span class="n">claims</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">ExpiredJwtException</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setErrCode</span><span class="p">(</span><span class="n">SystemConstant</span><span class="p">.</span><span class="na">JWT_ERRCODE_EXPIRE</span><span class="p">);</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setSuccess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">SignatureException</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setErrCode</span><span class="p">(</span><span class="n">SystemConstant</span><span class="p">.</span><span class="na">JWT_ERRCODE_FAIL</span><span class="p">);</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setSuccess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setErrCode</span><span class="p">(</span><span class="n">SystemConstant</span><span class="p">.</span><span class="na">JWT_ERRCODE_FAIL</span><span class="p">);</span>
            <span class="n">checkResult</span><span class="p">.</span><span class="na">setSuccess</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">checkResult</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="nf">static</span> <span class="n">SecretKey</span> <span class="nf">generalKey</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">byte</span><span class="p">[]</span> <span class="nf">encodedKey</span> <span class="o">=</span> <span class="n">Base64</span><span class="p">.</span><span class="na">decode</span><span class="p">(</span><span class="n">SystemConstant</span><span class="p">.</span><span class="na">JWT_SECERT</span><span class="p">);</span>
        <span class="n">SecretKey</span> <span class="nf">key</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SecretKeySpec</span><span class="p">(</span><span class="n">encodedKey</span><span class="p">,</span> <span class="n">0</span><span class="p">,</span> <span class="n">encodedKey</span><span class="p">.</span><span class="na">length</span><span class="p">,</span> <span class="s">&#34;AES&#34;</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">key</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="cm">/**
</span><span class="cm">     * 
</span><span class="cm">     * è§£æJWTå­—ç¬¦ä¸²
</span><span class="cm">     * @param jwt
</span><span class="cm">     * @return
</span><span class="cm">     * @throws Exception
</span><span class="cm">     */</span>
    <span class="kd">public</span> <span class="nf">static</span> <span class="n">Claims</span> <span class="nf">parseJWT</span><span class="p">(</span><span class="n">String</span> <span class="nf">jwt</span><span class="p">)</span> <span class="kd">throws</span> <span class="nf">Exception</span> <span class="p">{</span>
        <span class="n">SecretKey</span> <span class="nf">secretKey</span> <span class="o">=</span> <span class="n">generalKey</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">Jwts</span><span class="p">.</span><span class="na">parser</span><span class="p">()</span>
            <span class="p">.</span><span class="na">setSigningKey</span><span class="p">(</span><span class="n">secretKey</span><span class="p">)</span>
            <span class="p">.</span><span class="na">parseClaimsJws</span><span class="p">(</span><span class="n">jwt</span><span class="p">)</span>
            <span class="p">.</span><span class="na">getBody</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">å¦‚ä½•ä½¿ç”¨</span><span class="err">ï¼Ÿ</span><span class="n">ä»£ç å®ä¾‹</span><span class="err">ï¼š</span>

<span class="kd">public</span> <span class="nf">class</span> <span class="n">LoginController</span> <span class="p">{</span>
    <span class="nd">@Autowired</span>
    <span class="n">UserRepository</span> <span class="nf">userRepository</span><span class="p">;</span>
    
    <span class="nd">@ApiOperation</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;ç”¨æˆ·ç™»é™†&#34;</span><span class="p">)</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;login&#34;</span><span class="p">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="nf">ReturnVo</span> <span class="n">login</span><span class="p">(</span><span class="n">String</span> <span class="nf">username</span><span class="p">,</span> <span class="n">String</span> <span class="nf">password</span><span class="p">,</span><span class="n">HttpServletResponse</span>
            <span class="nf">response</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">User</span> <span class="nf">user</span> <span class="o">=</span>  <span class="n">userRepository</span><span class="p">.</span><span class="na">findByUsername</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">user</span><span class="o">!=</span><span class="kc">null</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getPassword</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">password</span><span class="p">)){</span>
                <span class="c1">//æŠŠtokenè¿”å›ç»™å®¢æˆ·ç«¯--&gt;å®¢æˆ·ç«¯ä¿å­˜è‡³cookie--&gt;å®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚é™„å¸¦cookieå‚æ•°
</span><span class="c1"></span>                <span class="n">String</span> <span class="nf">JWT</span> <span class="o">=</span> <span class="n">JwtUtils</span><span class="p">.</span><span class="na">createJWT</span><span class="p">(</span><span class="s">&#34;1&#34;</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">SystemConstant</span><span class="p">.</span><span class="na">JWT_TTL</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">ReturnVo</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">JWT</span><span class="p">);</span>
            <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="k">return</span> <span class="n">ReturnVo</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">return</span> <span class="n">ReturnVo</span><span class="p">.</span><span class="na">error</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nd">@ApiOperation</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;è·å–ç”¨æˆ·ä¿¡æ¯&#34;</span><span class="p">)</span>
    <span class="nd">@RequestMapping</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;description&#34;</span><span class="p">,</span><span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="p">.</span><span class="na">POST</span><span class="p">)</span>
    <span class="kd">public</span> <span class="nf">ReturnVo</span> <span class="n">description</span><span class="p">(</span><span class="n">String</span> <span class="nf">username</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">User</span> <span class="nf">user</span> <span class="o">=</span>  <span class="n">userRepository</span><span class="p">.</span><span class="na">findByUsername</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">ReturnVo</span><span class="p">.</span><span class="na">ok</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="na">getDescription</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<h3 id="å€Ÿé‰´">å€Ÿé‰´</h3>

<blockquote>
<p><a href="http://blog.leapoahead.com/2015/09/06/understanding-jwt/" rel="nofollow noreferrer" target="_blank">JSON Web Token</a><br />
<a href="https://www.cnblogs.com/menyiin/p/token.html" rel="nofollow noreferrer" target="_blank">tokençš„æœåŠ¡ç«¯æ ¡éªŒ</a><br />
<a href="https://cnodejs.org/topic/557844a8e3cc2f192486a8ff" rel="nofollow noreferrer" target="_blank">JWT åœ¨å‰åç«¯åˆ†ç¦»ä¸­çš„åº”ç”¨ä¸å®è·µ </a></p>
</blockquote>

    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>TGğŸ¬KOCO </span>
                </p>
            
           
            <p class="copyright-item">
                    <span>Words:</span>
                   <span>520</span>
            </p>
            
            <p class="copyright-item">
                
                <span>Share:</span>
                <span>

      
      
      
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2ftgkoco.github.io%2f2019%2fjwtjson-web-token%25E7%259A%2584%25E5%258E%259F%25E7%2590%2586%2f" target="_blank" title="Share on Facebook">
          <i class="iconfont icon-facebook"></i>
        </a>
        
      
      
      
      
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2ftgkoco.github.io%2f2019%2fjwtjson-web-token%25E7%259A%2584%25E5%258E%259F%25E7%2590%2586%2f&amp;title=JSON%20Web%20Token%e7%9a%84%e4%bd%9c%e7%94%a8%e5%92%8c%e8%a7%a3%e9%87%8a" target="_blank" title="Share on LinkedIn">
          <i class="iconfont icon-linkedin"></i>
        </a>
        
      
      
        
      
        
      

          

          

          

          
        <a href="//service.weibo.com/share/share.php?url=https%3a%2f%2ftgkoco.github.io%2f2019%2fjwtjson-web-token%25E7%259A%2584%25E5%258E%259F%25E7%2590%2586%2f&amp;appkey=&amp;title=JSON%20Web%20Token%e7%9a%84%e4%bd%9c%e7%94%a8%e5%92%8c%e8%a7%a3%e9%87%8a" target="_blank" title="Share on Douban ">
            <i class="iconfont icon-weibo"></i>
          </a>
          
</span>
                
            </p>

             
            <p class="copyright-item">
                Released under <a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a>
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-icon-tag"></i>Tag: 
            
            <span class="tag"><a href="https://tgkoco.github.io/tags/%E5%AD%A6%E4%B9%A0/">
                    #å­¦ä¹ </a></span>
            
            <span class="tag"><a href="https://tgkoco.github.io/tags/%E7%96%91%E6%83%91/">
                    #ç–‘æƒ‘</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">Back</a></span> Â· 
                <span><a href="https://tgkoco.github.io/">Home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://tgkoco.github.io/2019/1.unknwon%E7%9A%84%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" class="prev" rel="prev" title="Go è¯­è¨€å­¦ä¹ èµ„æ–™ä¸ç¤¾åŒºç´¢å¼•"><i class="iconfont icon-dajiantou"></i>&nbsp;Go è¯­è¨€å­¦ä¹ èµ„æ–™ä¸ç¤¾åŒºç´¢å¼•</a>
         
        
        <a href="https://tgkoco.github.io/2019/golanglog/" class="next" rel="next" title="GoåŒ…log">GoåŒ…log&nbsp;<i class="iconfont icon-xiaojiantou"></i></a>
        
    </div>

    <div class="post-comment">
          
          <div id="disqus_thread"></div>
    <script type="text/javascript">
    (function() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'tgkoco';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  

 


          
    </div>
</article>
          </div>
		   </main>
      
<style>
    body {
        cursor: url(https://tgkoco.github.io/cursor.ico), default;
    }
</style>

<script>
    var OriginTitile = document.title,
        titleTime;
    document.addEventListener("visibilitychange",
        function () {
            if (document.hidden) {
                $('[rel="shortcut icon"]').attr("href", "//tgkoco.github.io/fail.ico");
                $('[rel="icon"]').attr("href", "//tgkoco.github.io/fail.ico");
                $('[rel=" apple-touch-icon"]').attr("href", "//tgkoco.github.io/fail.ico");
                document.title = "(@_@)é¡µé¢å·²å´©æºƒï¼ç‚¹å‡»æ¢å¤ï¼";
                clearTimeout(titleTime)
            } else {
                $('[rel="shortcut icon"]').attr("href", "//tgkoco.github.io/favicon.ico");
                $('[rel="icon"]').attr("href", "//tgkoco.github.io/favicon.ico");
                $('[rel=" apple-touch-icon"]').attr("href", "//tgkoco.github.io/favicon.ico");
                document.title = "(/â‰§â–½â‰¦/)å’¦ï¼åˆå¥½äº†ï¼ " + OriginTitile;
                titleTime = setTimeout(function () {
                    document.title = OriginTitile
                },2000)
            }
        });
</script>

<footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2019 - 2019</span>
        
         
            <span class="author" itemprop="copyrightHolder"><a href="https://tgkoco.github.io/">TGğŸ¬KOCO</a> | </span>
         

		  <span>Crafted with â¤ï¸ by <a href="https://github.com/Fastbyte01/KeepIt" target="_blank" rel="external nofollow noopener noreffer">KeepIt</a> & <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a></span>
    </div>
</footer>












    
    
    <script src="https://tgkoco.github.io/js/vendor_no_gallery.min.js" async=""></script>
    
  







     </div>
  </body>
</html>
